version: "3.7"

services: 
  import-db:
    image: docker.pkg.github.com/satelit-project/satelit-import/import-db:latest
    container_name: import-db
    networks: 
      - hostnet
  
  import-serve:
    image: docker.pkg.github.com/satelit-project/satelit-import/import-serve:latest
    container_name: import-serve
    networks: 
      - hostnet
    volumes:
      - type: bind
        source: ../../static/tests/anidb-index
        target: /usr/share/nginx/anidb
        read_only: true
        volume:
          nocopy: true

  import-tests:
    image: docker.pkg.github.com/satelit-project/satelit-import/import-tests:latest
    container_name: import-tests
    networks: 
      - hostnet
    volumes:
      - type: bind
        source: ../..
        target: /satelit-import/repo
        volume:
          nocopy: true
    depends_on: 
      - import-db
      - import-serve

networks: 
  hostnet:
